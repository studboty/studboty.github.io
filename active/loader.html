<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>UV Active Loader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  background: #000;
}
#view {
  border: 0;
  width: 100vw;
  height: 100vh;
}
</style>
</head>

<body>

<iframe id="view"></iframe>

<script type="module">
  import { getUV } from "/active/scripts/prxy.mjs";

  let u = new URLSearchParams(location.search).get("url");

  if (u) {
    if (!u.startsWith("http")) u = "https://" + u;

    const iframe = document.getElementById("view");

    // Localhost: bypass proxy
    if (location.hostname === "localhost" || location.hostname === "127.0.0.1") {
      iframe.src = u;
      console.log("[Loader] Running locally, loading direct URL:", u);
    } else {
      // Production: use UV proxy
      try {
        const viewUrl = await getUV(u);
        iframe.src = viewUrl;
        console.log("[Loader] Running in production, UV proxied URL:", viewUrl);
      } catch (err) {
        console.error("[Loader] Failed to get UV URL:", err);
        iframe.src = u; // fallback
      }
    }
  }
</script>

</body>
</html>
